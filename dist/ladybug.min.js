/**
 * ladybug.min.js
 *
 * A tiny yet powerful (and beautiful) framework for JS applications
 *
 * @author   biohzrdmx <github.com/biohzrdmx>
 * @version  1.0
 * @license  MIT
 */

;"undefined"==typeof Ladybug&&(Ladybug={}),function(){var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Ladybug.Class=function(){},Ladybug.Class.extend=function(prop){function Class(){!initializing&&this.init&&this.init.apply(this,arguments)}var _super=this.prototype;initializing=!0;var prototype=new this;initializing=!1;for(var name in prop)prototype[name]="function"==typeof prop[name]&&"function"==typeof _super[name]&&fnTest.test(prop[name])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,prop[name]):prop[name];return Class.prototype=prototype,Class.prototype.constructor=Class,Class.extend=arguments.callee,Class}}(),Ladybug.Utils={compileTemplate:function(selector){var markup=$(selector).html()||"Template "+selector+" not found";return _.template(markup)},titleCase:function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}},Ladybug.Module=Ladybug.Class.extend({templates:null,partials:null,renderFlags:1,init:function(options){var obj=this,opts=$.extend(!0,{onInit:obj.onInit,onRender:obj.onRender,onDomReady:obj.onDomReady,onTitleRequest:obj.onTitleRequest,onPrepareTemplates:obj.onPrepareTemplates,templates:{},partials:{}},options);obj.onInit=opts.onInit,obj.onRender=opts.onRender,obj.onDomReady=opts.onDomReady,obj.onTitleRequest=opts.onTitleRequest,obj.onPrepareTemplates=opts.onPrepareTemplates,obj.templates=opts.templates,obj.partials=opts.partials},title:function(){var obj=this;return obj.onTitleRequest()},render:function(params){var obj=this;obj.onPrepareTemplates(params),obj.onRender(params),_.defer(function(){obj.onDomReady(params)})},onInit:function(){},onRender:function(){},onDomReady:function(){},onPrepareTemplates:function(){},onTitleRequest:function(){return!1}}),Ladybug.Router=Ladybug.Class.extend({callback:null,defaults:{onRouteChange:$.noop},init:function(options){var obj=this,opts=$.extend(!0,obj.defaults,options),cb=function(){var matches=location.hash.match(/([a-z0-9-_]+)/gi)||[],params=[];matches&&params.push(matches),opts.onRouteChange.call(obj,matches)},nativeSupport="undefined"!=typeof Moderniz&&Modernizr.hashchange?!0:"onhashchange"in window;if(nativeSupport)window.addEventListener?window.addEventListener("hashchange",cb,!1):window.attachEvent?window.attachEvent("onhashchange",cb):window.onhashchange=cb;else{var hash=location.hash,pf=function(){location.hash!=hash&&(hash=location.hash,cb()),setTimeout(pf,200)};pf()}obj.callback=cb},start:function(){this.callback.call()},navigate:function(route){location.hash="#"+route}}),Ladybug.Application=Ladybug.Class.extend({defaultRoute:null,element:null,modules:null,module:null,router:null,templates:{},partials:{},init:function(options){var obj=this,opts=$.extend(!0,{defaultRoute:"/home",element:"",onDomReady:obj.onDomReady},options);obj.defaultRoute=opts.defaultRoute,obj.onDomReady=opts.onDomReady,obj.element="string"==typeof opts.element?$(opts.element):opts.element,obj.modules={},jQuery(document).ready(function(){obj.onDomReady.call(obj,obj.element)}),obj.router=new Ladybug.Router({onRouteChange:function(params){if(params[0]){var module=obj.modules[params[0]]||null;if(module){obj.module=module,obj.element.attr("class","client cf page-"+params[0]),obj.module.onInit(),obj.module.render(params);var title=obj.module.title()||Ladybug.Utils.titleCase(params[0]);document.title=title}}else this.navigate(obj.defaultRoute)}})},onDomReady:function(){},registerModule:function(name,module){var obj=this;obj.modules[name]=module},apiCall:function(options){var obj=this,opts=$.extend(!0,{endpoint:"/status",method:"get",data:{},success:$.noop,error:$.noop},options);"undefined"==typeof constants||"undefined"==typeof constants.apiUrl||"undefined"==typeof constants.apiToken?console.error("Please define apiUrl and apiToken in your global constants object"):$.ajax({url:constants.apiUrl+opts.endpoint+"/?token="+constants.apiToken,type:opts.method,dataType:"json",data:opts.data,success:function(response){response&&"success"==response.result?opts.success.call(obj,response.data||{},response.extra||{}):opts.error.call(obj,response.message||"An error has ocurred, please try again later")},error:function(xhr,status,error){console.error("An error has ocurred: "+error)}})}}),Ladybug.FacebookApplication=Ladybug.Application.extend({onDomReady:function(){var obj=this;"undefined"==typeof constants||"undefined"==typeof constants.fbAppId?console.error("Please define fbAppId in your global constants object"):(window.fbAsyncInit=function(){FB.init({appId:constants.fbAppId,xfbml:!0,version:constants.fbVersion||"v2.7"}),obj.onFacebookReady()},function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),js.id=id,js.src="https://connect.facebook.net/en_US/sdk.js",fjs.parentNode.insertBefore(js,fjs))}(document,"script","facebook-jssdk"))},onFacebookReady:function(){}});